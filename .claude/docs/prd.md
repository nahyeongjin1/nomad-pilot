# Nomad-Pilot PRD (Product Requirements Document)

> 최종 수정: 2026-02-12 | Status: **Draft v3**

---

## 1. 프로덕트 비전

### "최저가 일본 자유여행 파일럿"

Nomad-Pilot은 **"예산만 말하면 일본 어디 갈지부터 어떻게 돌아다닐지까지 다 짜주는"** AI 여행 파일럿이다. 예산 기반 목적지 추천 → 최적 동선 설계 → 여행 중 일정 재조정까지 전 여정을 커버한다.

**MVP 타겟 시장: 한국 → 일본** (한국인 해외여행 1위 목적지, 엔저 + 가성비 여행 수요 최대)
향후 확장: 일본 → 동남아 → 유럽 순으로 지역 확대.

### 핵심 가치

- **가성비(Budget-first):** 예산 안에서 최대 가치의 일본 여행을 설계
- **현장성(On-site):** 오프라인 동작, 일정 차질 시 즉시 재계산
- **지능(Intelligence):** 사용자 취향 + 트렌드 반영, 맥락에 맞는 추천

---

## 2. 타겟 사용자

### Primary Persona: "가성비 일본 자유여행러" (1인)

- 혼자 또는 주도적으로 일본 여행 계획을 세우는 한국인
- "이번 달 50만원이면 일본 어디 갈 수 있지?"가 여행의 시작점
- 패키지보다 자유 여행, 관광지보다 로컬 핫플 선호
- 별도 앱 설치보다 링크 한 번 클릭 선호

### Secondary Persona: "소규모 그룹 여행자" (Phase 3)

- 2~5인 동행, 일정 조율 필요
- **MVP에서는 1인 여행에 집중, 그룹 기능은 유료 확장**

---

## 3. 서빙 형식: PWA (Mobile-First Web)

### 왜 PWA인가?

| 비교 항목     | Native App    | 일반 Web | **PWA**                 |
| ------------- | ------------- | -------- | ----------------------- |
| 설치 장벽     | 높음 (스토어) | 없음     | **없음 (홈 화면 추가)** |
| 오프라인 지원 | 완전          | 불가     | **Service Worker 캐싱** |
| GPS 접근      | 완전          | 제한적   | **브라우저 API로 충분** |
| 푸시 알림     | 완전          | 불가     | **Web Push 지원**       |
| 배포 속도     | 느림 (심사)   | 즉시     | **즉시**                |

**결론:** 일본 현장에서 QR 코드 하나로 즉시 접근. 해외에서 새 앱 다운로드 없이 바로 사용.

---

## 4. 타겟 시장: 일본

### 왜 일본부터인가?

| 항목       | 글로벌                 | 일본 한정                                             |
| ---------- | ---------------------- | ----------------------------------------------------- |
| 항공 검색  | 전 세계 목적지         | ICN/GMP → 도쿄, 오사카, 후쿠오카, 삿포로, 오키나와 등 |
| POI 데이터 | 수백만 건, 품질 불균일 | 일본 주요 도시, OSM 품질 우수                         |
| 통화/물가  | 다국가 환율            | JPY 단일                                              |
| 교통수단   | 국가별 천차만별        | 전철/버스 중심 (체계적, 데이터 풍부)                  |
| 언어       | 다국어 처리            | 한국어 UI + 일본어 POI                                |
| 수요       | 분산                   | 한국인 해외여행 1위 + 엔저 효과                       |

### 지원 도시 (MVP)

도쿄, 오사카, 교토, 후쿠오카, 삿포로, 오키나와(나하)
→ 사용자 데이터 보며 점진적 확대

### 확장 로드맵

Phase 1 (MVP): 일본 → Phase 2: 동남아 (베트남, 태국) → Phase 3: 유럽

---

## 5. 사용자 여정 (User Journey)

전체 서비스 흐름. 각 단계가 곧 기능 단위.

```text
[입력]    예산 + 월 + 기간 (1인 고정, 한국 출발)
              ↓
[탐색]    일본 도시 추천 (ICN → 일본 최저가 항공 기반)
              ↓  항공 딥링크 (Kiwi/Travelpayouts) → 제휴 수수료
[결정]    도시 확정 (예: 오사카)
              ↓
[예산]    잔여 예산 자동 계산 (항공 제외) → 숙소/식비/활동 JPY 배분 제안
              ↓
[발견]    현지 정보 제공
           ├─ 사람들이 많이 하는 것 (인기 활동/관광지)
           └─ 최근 핫한 것 (트렌딩 장소/맛집)
              ↓
[선택]    사용자가 직접 고르기
           ├─ 하고 싶은 활동
           ├─ 들리고 싶은 랜드마크
           ├─ 쇼핑하고 싶은 곳
           └─ 먹고 싶은 음식(점)
              ↓
[설계]    AI가 루트 선택지 생성 (일별 동선 + 전철/버스 교통 포함)
              ↓
[숙소]    루트 기반 최적 숙소 위치 추천 → 딥링크 (Booking/Agoda) → 제휴 수수료
              ↓
[확정]    최종 일정표 저장 / 링크 공유
              ↓
[가이드]  여행 중 실시간 파일럿 (Phase 2)
           ├─ 일정 차질 시 재계산 (늦잠, 휴업, 날씨 등)
           └─ 오프라인 일정 열람
```

---

## 6. 핵심 기능 (Features)

### Phase 1 - MVP: "예산 기반 일본 여행 설계"

> 예산을 입력하면 일본 도시 추천부터 일정표 완성까지

- **F1. 여행 조건 입력:** 예산(KRW), 월, 기간 입력 (1인, 한국 출발 고정)
- **F2. 일본 도시 추천:** Amadeus Flight Inspiration Search 기반 ICN→일본 최저가 도시 리스트
- **F3. 예산 분배:** 항공 제외 잔여 예산 → 숙소/식비/활동 JPY 자동 배분 제안
- **F4. 현지 POI 탐색:** 인기 장소 + 최근 핫플 카테고리별 제공 (OSM 기반 + Google Places 보강)
- **F5. 활동/장소 선택:** 사용자가 원하는 활동, 랜드마크, 쇼핑, 맛집 선택
- **F6. 루트 생성:** 선택 기반 일별 최적 동선 + 전철/버스 교통 포함 선택지 생성
- **F7. 숙소 추천:** 루트 기반 최적 위치 추천 + 예약 딥링크 (Booking/Agoda)
- **F8. 일정 저장/공유:** 최종 일정표 저장, 링크로 공유

### Phase 2 - Growth: "여행 중 파일럿"

> 여행 중 일정이 틀어졌을 때 즉시 재설계

- **F9. 일정 차질 재계산:** 수동 요청 또는 GPS 이탈 자동 감지 → 남은 일정 재최적화
- **F10. 오프라인 모드:** 네트워크 끊김 시 캐싱된 일정/지도 제공
- **F11. Web Push 알림:** "다음 장소 마감 임박", "날씨 변화" 등 상황 알림
- **F12. 지역 확장:** 동남아 (베트남, 태국) 추가

### Phase 3 - Monetize: "Pilot Pass"

> 프리미엄 기능으로 수익화

- **F13. 동행자 위치 확인:** 1회성 조회 방식 (탭 → 상대 마지막 위치 표시)
- **F14. 공동 일정 편집:** 동행자와 일정 수정
- **F15. AI 취향 최적화:** "많이 걷기 싫어", "사진 스팟 위주" 등 자연어 반영
- **F16. 도슨트 오디오 가이드:** 주요 관광지 음성 해설
- **F17. 프리미엄 POI 데이터:** 현지인 추천 숨은 명소
- **F18. 유럽 확장**

---

## 7. 기술 아키텍처 개요

### 핵심 설계 원칙: 저비용 + 단순 운영

- WebSocket을 쓰지 않아 상시 연결 서버 불필요
- MVP에서는 PostgreSQL(PostGIS) 하나로 DB/검색 역할 통합
- 일본 한정으로 데이터 규모 축소 → 비용/복잡도 절감

### Layer 구조

```text
[Client Layer]    React PWA (Vercel, $0)
                    ├─ Service Worker (오프라인, Web Push)
                    └─ Client Geofencing (GPS 이탈 감지)
        ↕ REST API
[API Layer]       NestJS (Railway Hobby, ~$5/월)
        ↕
[Data Layer]      PostgreSQL + PostGIS (Railway Hobby, 동일 플랜)
        ↕
[External]        Amadeus (항공 검색)
                  Kiwi/Travelpayouts (항공 딥링크)
                  Booking.com/Agoda (숙소 API + 딥링크)
                  Google Places (POI 상세 on-demand)
                  LLM API (경로 최적화)
```

### 인프라 구성 및 비용

| 역할     | 서비스                             | 비용                   | 비고                    |
| -------- | ---------------------------------- | ---------------------- | ----------------------- |
| Frontend | Vercel (React PWA)                 | $0                     | CDN, 자동 배포          |
| Backend  | Railway Hobby (NestJS)             | $5/월 (크레딧 포함)    | REST API, 비즈니스 로직 |
| DB       | Railway Hobby (PG17 + PostGIS 3.5) | ↑ 동일 크레딧에서 차감 | 원클릭 템플릿 배포      |
| AI       | LLM API                            | 사용량 비례            | 루트 최적화, 취향 해석  |

### 외부 API 전략 (Feasibility Study 기반)

상세: @feasibility-study.md

#### 항공: Amadeus (검색) + Kiwi/Travelpayouts (수익화)

- Amadeus Flight Inspiration Search: 출발지(ICN)만으로 일본 최저가 도시 검색. 무료 1,000~10,000콜/월
- Kiwi Tequila: 예약 딥링크 생성, 3% 수수료. NOMAD API로 다중 도시 검색 가능
- Travelpayouts: 진입장벽 낮은 대안, 수수료 100% 패스스루

#### 숙소: Agoda (초기) → Booking.com (MVP 런칭 후)

- Agoda: 가입 쉬움, 4~7% 수수료. MVP 초기에 활용
- Booking.com: 웹사이트 승인 필요 → MVP 런칭 후 신청, 실효 3.75~8% 수수료

#### POI: OSM (기본) + Google Places (on-demand 보강)

- OSM: 일본 POI 기본 데이터 (이름, 위치, 카테고리). 무료, 캐싱 가능
- Google Places (on-demand 보강):
  - 사용자가 POI 상세를 볼 때만 **Maps JS API Places Library로 클라이언트에서 직접 호출** (평점, 영업시간, 사진)
  - 무료 1,000콜/월
  - ToS상 서버에 POI 상세 데이터 저장 불가 → 서버 경유 무의미
  - `place_id`만 fire & forget으로 DB 저장 (커뮤니티 캐시: 한 유저가 매칭하면 모든 유저 혜택)
  - API 키 보안: Referrer 제한 + API 제한 + 일일 캡 + Firebase App Check

### 핵심 기술 스택

| 영역        | 기술                      | 역할                                       |
| ----------- | ------------------------- | ------------------------------------------ |
| Backend     | NestJS                    | REST API, 비즈니스 로직, 모듈/DI 구조      |
| Primary DB  | PostgreSQL + PostGIS      | POI 저장, 공간 쿼리, 경로 데이터, 트랜잭션 |
| 텍스트 검색 | PostgreSQL tsvector + GIN | POI 텍스트 검색 (일본어/한국어)            |
| AI          | LLM API                   | 루트 최적화, 자연어 취향 해석, 예산 배분   |
| Frontend    | React PWA                 | 모바일 UI, Service Worker, Web Push        |

### 스케일링 시 추가 도입 (MVP 이후)

| 기술          | 도입 시점                 | 역할                        |
| ------------- | ------------------------- | --------------------------- |
| Elasticsearch | 지역 확장으로 POI 급증 시 | Geo-shape 쿼리, 다국어 검색 |
| Redis         | 동시 사용자 증가 시       | POI 캐시, 세션              |

### WebSocket을 쓰지 않는 이유

| 기능          | 대체 방식             | 이유                              |
| ------------- | --------------------- | --------------------------------- |
| 일정 재계산   | REST 요청 (수동/자동) | 이벤트 발생 시에만 필요           |
| GPS 이탈 감지 | 클라이언트 Geofencing | 서버 부하 제거, 데이터 절약       |
| 알림          | Web Push API          | PWA 네이티브, 백그라운드 동작     |
| 동행자 위치   | 1회 조회 (REST)       | 해외 데이터 절약, 스냅샷이면 충분 |

### 기술적 챌린지

1. **공간 쿼리 최적화:** 일본 POI에서 "반경 내 평점 N 이상" 0.1초 응답 → GiST Index
2. **일별 클러스터링:** 선택된 장소들을 일자별로 지리적 군집화 → 하루 동선 최소화
3. **숙소 최적 위치:** 다일 루트의 무게중심 계산 → 전철 접근성 반영
4. **제약 조건 기반 재스케줄링:** 남은 시간 + 영업시간 + 거리 + 우선순위 → 재최적화
5. **일본어+한국어 복합 검색:** tsvector(GIN)로 양국 언어 POI 텍스트 검색

---

## 8. 비즈니스 모델

### 수익원 1: 제휴 딥링크 수수료 (Phase 1부터)

사용자의 자연스러운 여정에 제휴 링크가 녹아듦:

- 일본 도시 추천 → **항공 딥링크** (Kiwi 3% 수수료 / Travelpayouts)
- 숙소 추천 → **숙소 딥링크** (Agoda 4~7% → Booking.com 3.75~8%)

### 수익원 2: Pilot Pass 구독 (Phase 3)

| 구분                  | 무료    | Pilot Pass (유료) |
| --------------------- | ------- | ----------------- |
| 도시 추천 + 루트 생성 | ✅      | ✅                |
| 예산 분배 제안        | ✅      | ✅                |
| 일정 저장             | 3개까지 | 무제한            |
| 여행 중 재스케줄링    | ❌      | ✅                |
| 오프라인 모드         | ❌      | ✅                |
| 동행자 위치/공동 편집 | ❌      | ✅                |
| AI 취향 최적화        | ❌      | ✅                |
| 도슨트 오디오         | ❌      | ✅                |

### 수익원 3: B2B (향후)

- 여행사/호텔에 루트 설계 엔진 API 제공

---

## 9. 성공 지표 (KPI)

### Phase 1 (MVP)

- 루트 생성 완료율 > 70% (입력 시작 → 일정표 완성)
- 항공/숙소 딥링크 클릭률 > 15%
- 공간 쿼리 응답 시간 < 100ms (P95)
- 평균 루트 생성 시간 < 3초

### Phase 2 (Growth)

- DAU 1,000명
- 재스케줄링 사용률 > 30% (여행 중 사용자 중)
- 경로 공유율 > 20%

### Phase 3 (Monetize)

- Pilot Pass 전환율 > 5%
- 딥링크 월 매출 > 제휴별 목표 설정
- 유료 사용자 월간 이탈률 < 10%

---

## 10. 태스크 분해 (Development Roadmap)

각 태스크의 상세 계획은 `plans/` 폴더에 별도 문서로 관리.

### 🏗️ Foundation (기반)

- **T01.** 프로젝트 초기 설정 (NestJS + Railway 배포, PG17+PostGIS 3.5 템플릿, 개발 환경)
- **T02.** DB 스키마 설계 (PostGIS 기반 POI/Trip/User 모델, 일본 도시 데이터)
- **T03.** 공간 쿼리 최적화 전략 (GiST 인덱스, 벤치마크)

### 🔍 Search & Data (검색 & 데이터)

- **T04.** POI 검색 설계 (일본어+한국어 tsvector + GIN)
- **T05.** 일본 POI 데이터 파이프라인 (OSM Japan 추출 → DB 적재 + Google Places 보강 전략)
- **T06a.** 항공 API 연동 (Amadeus 검색 + Travelpayouts 딥링크)
- **T06b.** 숙소 API 연동 (Agoda/Booking 제휴 승인 후)

### 🧭 Core Engine (핵심 엔진)

- **T07.** 예산 분배 로직 (KRW→JPY 환율, 일본 도시별 물가 반영)
- **T08.** 경로 최적화 알고리즘 (일별 클러스터링, TSP 변형, 전철/버스 교통 반영)
- **T09.** 숙소 위치 추천 로직 (루트 무게중심, 전철역 접근성)
- **T10.** 주변 POI 추천 로직 (거리 + 평점 + 카테고리 + 예산 가중치)
- **T11.** AI Integration (LLM 활용 자연어 최적화, 취향 해석)

### 📡 여행 중 지원

- **T12.** 일정 재스케줄링 엔진 (제약 조건 기반 재최적화)
- **T13.** Client Geofencing 설계 (GPS 이탈 감지 로직)
- **T14.** Web Push 알림 설계 (상황별 알림 트리거)

### 📱 Frontend

- **T15.** PWA 설계 (Service Worker, 오프라인 전략, 캐싱 정책)
- **T16.** 지도 UI/UX 설계 (맵 라이브러리 선정, 인터랙션)

### 💰 Monetization

- **T17.** 인증/결제 시스템 설계
- **T18.** Pilot Pass 기능 게이팅
- **T19.** 딥링크/제휴 수수료 트래킹 설계

### 🚀 Infra & DevOps

- **T20.** 배포 아키텍처 (Vercel + Railway, CI/CD)

---

## Appendix: 용어 정의

| 용어       | 정의                                                                      |
| ---------- | ------------------------------------------------------------------------- |
| POI        | Point of Interest. 관광지, 맛집, 카페 등 장소 데이터                      |
| Trip       | 하나의 여행 계획 단위 (목적지 + 기간 + 일정)                              |
| Path       | 복수의 POI를 연결한 일별 최적 이동 경로                                   |
| Pilot      | AI 기반 여행 가이드 기능의 브랜딩                                         |
| Geofencing | 가상 지리적 경계를 설정하고 이탈 시 이벤트 발생시키는 기법                |
| GiST Index | PostGIS에서 공간 데이터 검색에 사용하는 인덱스 타입                       |
| TSP        | Traveling Salesman Problem. 경로 최적화의 기반 알고리즘                   |
| 딥링크     | 외부 예약 플랫폼의 특정 상품 페이지로 바로 연결되는 링크 (제휴 추적 포함) |

---

## Appendix: 의사결정 이력

| 날짜       | 결정                           | 근거                                                                                |
| ---------- | ------------------------------ | ----------------------------------------------------------------------------------- |
| 2026-02-12 | 서빙 형식: PWA                 | 진입장벽 최소화, 오프라인 지원, 해외 즉시 접근                                      |
| 2026-02-12 | 방향: 최저가 여행 파일럿       | 가치 제안 명확화, 타겟 확장, 수익화 경로 다양화                                     |
| 2026-02-12 | MVP 1인 여행 고정              | 그룹 복잡도 회피, DB 확장 가능 설계, 그룹은 Phase 3 유료                            |
| 2026-02-12 | WebSocket 전면 제거            | REST + Web Push + Client Geofencing 대체. 해외 데이터 절약                          |
| 2026-02-12 | 동행자 위치: 1회 조회 방식     | 실시간 불필요, REST 조회로 충분                                                     |
| 2026-02-12 | 인프라: Vercel + Railway Hobby | Frontend $0 + Backend/DB $5/월. NestJS 학습 목적 유지                               |
| 2026-02-12 | MVP DB 단일화: PostgreSQL만    | tsvector+GIN 텍스트 검색, PostGIS 공간 검색, JWT 세션                               |
| 2026-02-12 | MVP 일본 한정                  | 한국인 해외여행 1위, OSM 품질 우수, 교통 체계적, 스코프 축소. @feasibility-study.md |
| 2026-02-12 | 항공: Amadeus + Kiwi           | Amadeus(검색, 무료) + Kiwi(딥링크, 3%). @feasibility-study.md §1                    |
| 2026-02-12 | 숙소: Agoda → Booking.com      | Agoda(초기, 가입 쉬움) → Booking.com(런칭 후 승인). @feasibility-study.md §2        |
| 2026-02-12 | POI: OSM + Google Places       | OSM(기본, 무료 캐싱) + Google(on-demand 보강). @feasibility-study.md §3             |
| 2026-02-12 | Railway PostGIS: PG17 + 3.5    | 원클릭 템플릿 배포 확인. @feasibility-study.md §4                                   |
